<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SuperDuperGraphs Demo</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #0b1223;
        --panel: #0f172a;
        --border: #1e293b;
        --text: #e2e8f0;
        --muted: #94a3b8;
        --accent: #38bdf8;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Space Grotesk", "Segoe UI", system-ui, -apple-system, sans-serif;
        background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.12), transparent 30%),
          radial-gradient(circle at 80% 0%, rgba(244, 114, 182, 0.12), transparent 26%),
          var(--bg);
        color: var(--text);
      }
      header {
        padding: 16px 20px 8px;
      }
      h1 {
        margin: 0 0 6px;
        font-size: 22px;
      }
      p {
        margin: 0;
        color: var(--muted);
      }
      .shell {
        display: grid;
        grid-template-rows: auto 1fr;
        gap: 12px;
        height: 100vh;
      }
      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 8px;
        padding: 0 20px 8px;
      }
      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      }
      .panel label {
        font-size: 12px;
        color: var(--muted);
      }
      .panel button,
      .panel input,
      .panel select {
        background: #111a30;
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 8px 12px;
        font: inherit;
        cursor: pointer;
        transition: border-color 120ms ease, transform 120ms ease, background 120ms ease;
      }
      .panel button[data-active="true"] {
        border-color: var(--accent);
        color: var(--accent);
        transform: translateY(-1px);
        background: rgba(56, 189, 248, 0.08);
      }
      .panel button:hover {
        border-color: var(--accent);
      }
      .panel input,
      .panel select {
        cursor: text;
      }
      .chart-area {
        padding: 0 20px 20px;
      }
      #chart {
        width: 100%;
        height: calc(100vh - 220px);
        min-height: 320px;
        background: var(--panel);
        border-radius: 14px;
        border: 1px solid var(--border);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
        overflow: hidden;
      }
      @media (max-width: 720px) {
        .shell {
          grid-template-rows: auto 1fr;
        }
        .controls {
          grid-template-columns: 1fr;
        }
        #chart {
          height: calc(100vh - 320px);
        }
      }
      .emoji-picker {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(32px, 1fr));
        gap: 6px;
        max-height: 200px;
        overflow: auto;
        padding: 6px;
        background: #0c1325;
        border: 1px solid var(--border);
        border-radius: 10px;
      }
      .emoji-picker button {
        padding: 6px;
        font-size: 18px;
        text-align: center;
      }
      .emoji-control {
        position: relative;
        display: grid;
        gap: 6px;
        width: 100%;
      }
      .emoji-input {
        width: 52px;
        text-align: center;
        justify-self: start;
      }
      .emoji-popover {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        z-index: 10;
        background: #0d162a;
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
        padding: 10px;
      }
      .emoji-popover header {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
      }
      .emoji-popover input {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header>
        <h1>SuperDuperGraphs</h1>
        <p>Interactive stock chart playground with drawings like text, emoji, pencil, arrows, shapes, and projections. Use Grab to move, corner handles to resize, and hold Shift while dragging to rotate. Scroll to zoom and drag empty space to pan.</p>
      </header>
      <div class="controls">
        <div class="panel" id="tools-panel">
          <label>Tools</label>
          <button data-tool="pencil">Pencil</button>
          <button data-tool="arrow">Arrow</button>
          <button data-tool="line">Line</button>
          <button data-tool="rectangle">Rectangle</button>
          <button data-tool="ellipse">Ellipse</button>
          <button data-tool="text">Text</button>
          <button data-tool="emoji">Emoji</button>
          <button data-tool="projection">Projection</button>
          <button data-tool="grab" title="Drag to move, Shift+drag to rotate, corner handles resize">Grab / Rotate / Resize</button>
          <button data-tool="erase">Erase</button>
          <button id="undo-drawing">Undo</button>
          <button id="clear-drawings">Clear drawings</button>
          <button id="download-image">Download PNG</button>
        </div>
        <div class="panel">
          <label for="stroke">Stroke</label>
          <input id="stroke" type="color" value="#38bdf8" />
          <div class="emoji-control" id="emoji-control">
            <label for="emoji-char">Emoji</label>
            <input id="emoji-char" class="emoji-input" type="text" value="ðŸ˜€" maxlength="4" />
            <div id="emoji-popover" class="emoji-popover" hidden>
              <header>
                <input id="emoji-search" type="text" placeholder="Search emoji" maxlength="18" />
                <button type="button" id="emoji-close">Close</button>
              </header>
              <div id="emoji-picker" class="emoji-picker"></div>
            </div>
          </div>
          <label for="text-note">Text</label>
          <input id="text-note" type="text" value="Note" />
          <label for="projection-label">Projection</label>
          <input id="projection-label" type="text" value="Projection" />
          <button id="regenerate">Regenerate data</button>
        </div>
      </div>
      <div class="chart-area">
        <div id="chart"></div>
      </div>
    </div>

    <script type="module">
      import { SuperDuperChart } from '../dist/index.js';

      const chartContainer = document.getElementById('chart');
      const strokeInput = document.getElementById('stroke');
      const emojiInput = document.getElementById('emoji-char');
      const textInput = document.getElementById('text-note');
      const projectionInput = document.getElementById('projection-label');
      const clearBtn = document.getElementById('clear-drawings');
      const undoBtn = document.getElementById('undo-drawing');
      const downloadBtn = document.getElementById('download-image');
      const regenerateBtn = document.getElementById('regenerate');
      const toolButtons = Array.from(document.querySelectorAll('[data-tool]'));
      const emojiPickerEl = document.getElementById('emoji-picker');
      const emojiSearch = document.getElementById('emoji-search');
      const emojiClose = document.getElementById('emoji-close');
      const emojiPopover = document.getElementById('emoji-popover');

      const EMOJI_SET = [
        'ðŸ˜€','ðŸ˜ƒ','ðŸ˜„','ðŸ˜','ðŸ˜†','ðŸ˜…','ðŸ˜‚','ðŸ¤£','ðŸ˜Š','ðŸ˜‡','ðŸ™‚','ðŸ™ƒ','ðŸ˜‰','ðŸ˜Œ','ðŸ˜','ðŸ¥°','ðŸ˜˜','ðŸ˜—','ðŸ˜™','ðŸ˜š','ðŸ˜‹','ðŸ˜›','ðŸ˜','ðŸ˜œ','ðŸ¤ª','ðŸ¤¨','ðŸ§','ðŸ¤“','ðŸ˜Ž','ðŸ¤©','ðŸ¥³','ðŸ˜','ðŸ˜’','ðŸ˜ž','ðŸ˜”','ðŸ˜Ÿ','ðŸ˜•','ðŸ™','â˜¹ï¸','ðŸ˜£','ðŸ˜–','ðŸ˜«','ðŸ˜©','ðŸ¥º','ðŸ˜¢','ðŸ˜­','ðŸ˜¤','ðŸ˜ ','ðŸ˜¡','ðŸ¤¬','ðŸ¤¯','ðŸ˜³','ðŸ¥µ','ðŸ¥¶','ðŸ˜±','ðŸ˜¨','ðŸ˜°','ðŸ˜¥','ðŸ˜“','ðŸ¤—','ðŸ¤”','ðŸ¤­','ðŸ¤«','ðŸ¤¥','ðŸ˜¶','ðŸ˜','ðŸ˜‘','ðŸ˜¬','ðŸ™„','ðŸ˜¯','ðŸ˜¦','ðŸ˜§','ðŸ˜®','ðŸ˜²','ðŸ¥±','ðŸ˜´','ðŸ¤¤','ðŸ˜ª','ðŸ˜µ','ðŸ¤','ðŸ¥´','ðŸ¤¢','ðŸ¤®','ðŸ¤§','ðŸ˜·','ðŸ¤’','ðŸ¤•','ðŸ¤ ','ðŸ¥¸','ðŸ˜º','ðŸ˜¸','ðŸ˜¹','ðŸ˜»','ðŸ˜¼','ðŸ˜½','ðŸ™€','ðŸ˜¿','ðŸ˜¾',
        'ðŸ‘','ðŸ‘Ž','ðŸ‘Š','âœŠ','ðŸ¤›','ðŸ¤œ','ðŸ‘','ðŸ™Œ','ðŸ‘','ðŸ¤²','ðŸ¤','ðŸ™','âœï¸','ðŸ’ª','ðŸ¦¾','ðŸ–•','âœŒï¸','ðŸ¤Ÿ','ðŸ¤˜','ðŸ¤™','ðŸ‘ˆ','ðŸ‘‰','ðŸ‘†','ðŸ‘‡','â˜ï¸','ðŸ‘ðŸ»','ðŸ‘ðŸ¼','ðŸ‘ðŸ½','ðŸ‘ðŸ¾','ðŸ‘ðŸ¿','ðŸ‘‹','ðŸ¤š','ðŸ–ï¸','âœ‹','ðŸ––','ðŸ‘Œ','ðŸ¤Œ','ðŸ¤','âœŠðŸ»','âœŠðŸ¼','âœŠðŸ½','âœŠðŸ¾','âœŠðŸ¿','ðŸ¤²ðŸ»','ðŸ¤²ðŸ¼','ðŸ¤²ðŸ½','ðŸ¤²ðŸ¾','ðŸ¤²ðŸ¿',
        'â¤ï¸','ðŸ§¡','ðŸ’›','ðŸ’š','ðŸ’™','ðŸ’œ','ðŸ¤Ž','ðŸ–¤','ðŸ¤','ðŸ’”','â£ï¸','ðŸ’•','ðŸ’ž','ðŸ’“','ðŸ’—','ðŸ’–','ðŸ’˜','ðŸ’','ðŸ’Ÿ','ðŸ’¯','ðŸ’¢','ðŸ’¥','ðŸ’«','ðŸ’¦','ðŸ’¨','âœ¨','â­','ðŸŒŸ','ðŸ”¥','ðŸ§¨','ðŸŽ‰','ðŸŽŠ','ðŸŽˆ','ðŸŽ','ðŸŽ€','ðŸª„','ðŸª…','ðŸª©',
        'ðŸŒž','ðŸŒ','ðŸŒš','ðŸŒ™','â­','ðŸŒŸ','â˜ï¸','â›…','ðŸŒ§ï¸','â›ˆï¸','ðŸŒ©ï¸','â„ï¸','ðŸŒˆ','ðŸŒ‚','â˜”','âš¡','â˜€ï¸','ðŸŒªï¸',
        'ðŸŽ','ðŸŠ','ðŸ‹','ðŸŒ','ðŸ‰','ðŸ‡','ðŸ“','ðŸ«','ðŸ’','ðŸ‘','ðŸ¥­','ðŸ','ðŸ¥¥','ðŸ¥','ðŸ…','ðŸ†','ðŸ¥‘','ðŸ¥¦','ðŸ¥•','ðŸŒ½','ðŸŒ¶ï¸','ðŸ¥’','ðŸ¥¬','ðŸ§„','ðŸ§…','ðŸ¥”','ðŸ ',
        'ðŸ•','ðŸ”','ðŸŸ','ðŸŒ­','ðŸ¥ª','ðŸ¥™','ðŸŒ®','ðŸŒ¯','ðŸ¥—','ðŸ¿','ðŸ§‚','ðŸ§€','ðŸ¥š','ðŸ³','ðŸ¥ž','ðŸ§‡','ðŸ¥“','ðŸ–','ðŸ—','ðŸ¥©','ðŸ¤','ðŸ£','ðŸ±','ðŸ›','ðŸœ','ðŸ','ðŸ²','ðŸ¥','ðŸ¥ ','ðŸ¥¡',
        'ðŸ¦','ðŸ§','ðŸ¨','ðŸ©','ðŸª','ðŸŽ‚','ðŸ°','ðŸ§','ðŸ¥§','ðŸ«','ðŸ¬','ðŸ­','ðŸ®','ðŸ¯','ðŸ¼','ðŸ¥›','â˜•','ðŸµ','ðŸ§ƒ','ðŸ¥¤','ðŸ»','ðŸº','ðŸ·','ðŸ¥‚','ðŸ¹','ðŸ¸','ðŸ¾','ðŸ§‰',
        'âš½','ðŸ€','ðŸˆ','âš¾','ðŸŽ¾','ðŸ','ðŸ‰','ðŸ¥','ðŸŽ±','ðŸ“','ðŸ¸','ðŸ¥…','ðŸ’','ðŸ‘','ðŸ','ðŸ¥','ðŸ¹','ðŸŽ£','ðŸ¤¿','ðŸ¥Š','ðŸ¥‹','ðŸŽ½','ðŸ›¹','ðŸ›¼','ðŸ›·','â›¸ï¸','ðŸ¥Œ','ðŸª‚','ðŸŽ¿','â›·ï¸','ðŸ‚',
        'ðŸŽµ','ðŸŽ¶','ðŸŽ¼','ðŸŽ¹','ðŸ¥','ðŸŽ·','ðŸŽº','ðŸŽ¸','ðŸª•','ðŸŽ»','ðŸªˆ',
        'âŒš','ðŸ“±','ðŸ’»','âŒ¨ï¸','ðŸ–¥ï¸','ðŸ–¨ï¸','ðŸ–±ï¸','ðŸ•¹ï¸','ðŸ’½','ðŸ’¾','ðŸ’¿','ðŸ“€','ðŸ“·','ðŸŽ¥','ðŸ“¹','ðŸ“¸','ðŸ“ž','â˜Žï¸','ðŸ“º','ðŸ“»','ðŸŽ™ï¸','ðŸŽšï¸','ðŸŽ›ï¸','ðŸ§­','â±ï¸','â²ï¸','â°','ðŸ•°ï¸','ðŸ—‘ï¸','ðŸª‘','ðŸ›‹ï¸','ðŸ›ï¸','ðŸšª','ðŸªŸ','ðŸ§³','ðŸª '
      ];

      const chart = new SuperDuperChart(chartContainer, {
        data: buildSeries(160),
        showVolume: true
      });

      let activeTool = null;

      function setTool(tool) {
        activeTool = tool;
        toolButtons.forEach((btn) => btn.setAttribute('data-active', btn.dataset.tool === tool));
        const common = { color: strokeInput.value, width: 2 };
        switch (tool) {
          case 'pencil':
            chart.setActiveTool('pencil', { ...common, width: 2 });
            break;
          case 'arrow':
            chart.setActiveTool('arrow', { ...common });
            break;
          case 'line':
            chart.setActiveTool('line', { ...common });
            break;
          case 'rectangle':
            chart.setActiveTool('rectangle', { ...common, fill: 'rgba(56, 189, 248, 0.12)' });
            break;
          case 'ellipse':
            chart.setActiveTool('ellipse', { ...common, fill: 'rgba(56, 189, 248, 0.12)' });
            break;
          case 'text':
            chart.setActiveTool('text', { ...common, text: textInput.value });
            break;
          case 'emoji':
            chart.setActiveTool('emoji', { ...common, emoji: emojiInput.value || 'ðŸ˜€' });
            break;
          case 'projection':
            chart.setActiveTool('projection', { ...common, label: projectionInput.value, dash: [8, 6] });
            break;
          case 'grab':
            chart.setActiveTool('grab', { tolerance: 10 });
            break;
          case 'erase':
            chart.setActiveTool('erase', { tolerance: 10 });
            break;
          default:
            chart.setActiveTool(null);
        }
      }

      toolButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          setTool(btn.dataset.tool);
        });
      });

      clearBtn.addEventListener('click', () => {
        chart.clearDrawings();
      });

      undoBtn.addEventListener('click', () => {
        chart.undoLastDrawing();
      });

      downloadBtn.addEventListener('click', () => {
        chart.downloadImage('superduper-chart.png');
      });

      regenerateBtn.addEventListener('click', () => {
        chart.setData(buildSeries(160));
      });

      strokeInput.addEventListener('input', () => {
        if (activeTool) setTool(activeTool);
      });
      textInput.addEventListener('input', () => {
        if (activeTool === 'text') setTool('text');
      });
      emojiInput.addEventListener('input', () => {
        if (activeTool === 'emoji') setTool('emoji');
      });
      emojiSearch.addEventListener('input', () => {
        renderEmoji(emojiSearch.value);
      });
      emojiInput.addEventListener('click', (e) => {
        e.stopPropagation();
        emojiPopover.removeAttribute('hidden');
        renderEmoji(emojiSearch.value);
      });
      emojiInput.addEventListener('focus', () => {
        emojiPopover.removeAttribute('hidden');
        renderEmoji(emojiSearch.value);
      });
      emojiClose.addEventListener('click', () => {
        emojiPopover.setAttribute('hidden', 'true');
      });
      document.addEventListener('click', (e) => {
        if (!emojiPopover.hasAttribute('hidden') && !emojiPopover.contains(e.target) && !emojiInput.contains(e.target)) {
          emojiPopover.setAttribute('hidden', 'true');
        }
      });
      projectionInput.addEventListener('input', () => {
        if (activeTool === 'projection') setTool('projection');
      });

      function renderEmoji(query = '') {
        const trimmed = query.trim().toLowerCase();
        emojiPickerEl.innerHTML = '';
        const fragment = document.createDocumentFragment();
        EMOJI_SET.filter((e) => !trimmed || e.toLowerCase().includes(trimmed)).forEach((emoji) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.textContent = emoji;
          btn.addEventListener('click', () => {
            emojiInput.value = emoji;
            setTool('emoji');
            emojiPopover.setAttribute('hidden', 'true');
          });
          fragment.appendChild(btn);
        });
        emojiPickerEl.appendChild(fragment);
      }

      setTool('pencil');
      renderEmoji();

      function buildSeries(length = 120) {
        const points = [];
        let last = 100;
        const start = Date.now() - length * 24 * 60 * 60 * 1000;
        for (let i = 0; i < length; i += 1) {
          const drift = (Math.random() - 0.45) * 2;
          const open = last;
          const close = Math.max(2, open + drift);
          const high = Math.max(open, close) + Math.random() * 1.5;
          const low = Math.min(open, close) - Math.random() * 1.5;
          const volume = 1000 + Math.random() * 9000;
          last = close;
          points.push({
            time: start + i * 24 * 60 * 60 * 1000,
            open: Number(open.toFixed(2)),
            high: Number(high.toFixed(2)),
            low: Number(low.toFixed(2)),
            close: Number(close.toFixed(2)),
            volume: Math.round(volume)
          });
        }
        return points;
      }
    </script>
  </body>
</html>
